{% macro lesson_content_viewer(lesson_type, media_url, download_url, text_content, is_markdown, is_pdf, is_html, video_speed, audio_speed) %}
<!-- Lesson Content Viewer Component -->
<div class="ls-lesson-view-content">
    {% if lesson_type == 'video' %}
        <!-- Video Player -->
        <div class="ls-video-player-container">
            <video
                id="lessonVideoPlayer"
                class="ls-video-player"
                controls
                controlsList="nodownload"
                preload="metadata">
                <source src="{{ media_url }}" type="video/mp4">
                Your browser does not support the video player.
            </video>
            <div class="ls-player-controls">
                <label for="videoSpeed">Playback Speed:</label>
                <select id="videoSpeed" class="ls-speed-selector">
                    <option value="0.25">0.25x</option>
                    <option value="0.5">0.5x</option>
                    <option value="0.75">0.75x</option>
                    <option value="1.0" {% if video_speed == 1.0 %}selected{% endif %}>1.0x</option>
                    <option value="1.25" {% if video_speed == 1.25 %}selected{% endif %}>1.25x</option>
                    <option value="1.5" {% if video_speed == 1.5 %}selected{% endif %}>1.5x</option>
                    <option value="1.75" {% if video_speed == 1.75 %}selected{% endif %}>1.75x</option>
                    <option value="2.0" {% if video_speed == 2.0 %}selected{% endif %}>2.0x</option>
                </select>
            </div>
        </div>

    {% elif lesson_type == 'audio' %}
        <!-- Audio Player -->
        <div class="ls-audio-player-container">
            <audio
                id="lessonAudioPlayer"
                class="ls-audio-player"
                controls
                controlsList="nodownload"
                preload="metadata">
                <source src="{{ media_url }}" type="audio/mpeg">
                Your browser does not support the audio player.
            </audio>
            <div class="ls-player-controls">
                <label for="audioSpeed">Playback Speed:</label>
                <select id="audioSpeed" class="ls-speed-selector">
                    <option value="0.25">0.25x</option>
                    <option value="0.5">0.5x</option>
                    <option value="0.75">0.75x</option>
                    <option value="1.0" {% if audio_speed == 1.0 %}selected{% endif %}>1.0x</option>
                    <option value="1.25" {% if audio_speed == 1.25 %}selected{% endif %}>1.25x</option>
                    <option value="1.5" {% if audio_speed == 1.5 %}selected{% endif %}>1.5x</option>
                    <option value="1.75" {% if audio_speed == 1.75 %}selected{% endif %}>1.75x</option>
                    <option value="2.0" {% if audio_speed == 2.0 %}selected{% endif %}>2.0x</option>
                </select>
            </div>
        </div>

    {% elif lesson_type == 'text' %}
        {% if is_pdf %}
            <!-- PDF Viewer -->
            <div class="ls-pdf-viewer-container">
                <div class="ls-pdf-controls">
                    <a href="{{ media_url }}" class="ls-btn ls-btn--primary ls-pdf-open-btn" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <line x1="10" y1="14" x2="21" y2="3"></line>
                        </svg>
                        Open PDF
                    </a>
                    <a href="{{ download_url }}" class="ls-btn" download>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Download
                    </a>
                </div>

                <!-- PDF iframe viewer (shows on desktop, hides on actual mobile devices) -->
                <iframe
                    class="ls-pdf-viewer"
                    src="{{ media_url }}#view=FitH&toolbar=0&navpanes=0&scrollbar=1"
                    type="application/pdf">
                    <div class="ls-pdf-fallback">
                        <p class="ls-text-muted">Your browser does not support PDF viewing.</p>
                        <a href="{{ media_url }}" class="ls-btn ls-btn--primary" target="_blank">Open PDF</a>
                    </div>
                </iframe>

                <!-- Mobile-only message (only shows on actual mobile devices) -->
                <div class="ls-pdf-mobile-message">
                    <div class="ls-pdf-mobile-content">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        <p class="ls-text-muted">PDF preview works best on desktop.</p>
                        <p class="ls-text-sm">Use the buttons above to open or download the PDF.</p>
                    </div>
                </div>
            </div>

        {% else %}
            <!-- Text/HTML Content Viewer -->
            <div class="ls-text-viewer-container">
                <div class="ls-text-controls">
                    <a href="{{ download_url }}" class="ls-btn ls-btn--primary" download>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Download File
                    </a>
                </div>

                {% if text_content %}
                    {% if is_markdown %}
                        <!-- Markdown Rendered View -->
                        <div class="ls-text-content markdown">
                            {{ text_content | safe }}
                        </div>

                    {% elif is_html %}
                        <!-- HTML: Code View & Rendered View -->
                        <div class="ls-html-tabs">
                            <button class="ls-tab-btn active" data-tab="code">Code</button>
                            <button class="ls-tab-btn" data-tab="preview">Preview</button>
                        </div>

                        <div class="ls-tab-content active" id="code-tab">
                            <div class="ls-code-block">
                                <pre><code>{{ text_content }}</code></pre>
                            </div>
                        </div>

                        <div class="ls-tab-content" id="preview-tab">
                            <div class="ls-html-preview">
                                <iframe srcdoc="{{ text_content }}" sandbox="allow-same-origin"></iframe>
                            </div>
                        </div>

                    {% else %}
                        <!-- Plain Text: Code Block View -->
                        <div class="ls-code-block">
                            <pre><code>{{ text_content }}</code></pre>
                        </div>
                    {% endif %}
                {% else %}
                    <p class="ls-text-muted">No content available.</p>
                {% endif %}
            </div>
        {% endif %}

    {% else %}
        <!-- Unsupported File Type -->
        <div class="ls-unsupported-container">
            <p class="ls-text-muted">This file type is not supported for preview.</p>
            <a href="{{ download_url }}" class="ls-btn ls-btn--primary" download>
                Download File
            </a>
        </div>
    {% endif %}
</div>
{% endmacro %}
